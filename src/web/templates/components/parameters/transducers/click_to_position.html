<script>
  function clickToPositionTransducerHandler(button){
    const fieldset = button.closest("fieldset")

    showLoading("Rendering Layout...")
    disallowRunSimulation()
    clearPlotArea()

    const url = "{{ url_for('main.render_canvas') }}"
    fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: getFullRequestBody(),
    })
      .then((response) => response.json())
      .then((data) => {
        hideLoading()
        
        const label = document.createElement('p');
        label.textContent = 'Click on the image to place the transducer';
        label.style.textAlign = 'center';

        plotArea.insertBefore(label, plotArea.firstChild);

        const clickCallback = (xData, yData) => {
          xData = xData.toFixed(6)
          yData = yData.toFixed(6)
          // Update the form
          if (scenarioIs2d()) {
            fieldset.querySelector("input[name='positionX']").value = yData
            fieldset.querySelector("input[name='positionY']").value = xData
          } else{
            const sliceAxis = document.getElementById("sliceAxis").value
            switch (sliceAxis)
            {
              case "x":
                fieldset.querySelector("input[name='positionY']").value = yData
                fieldset.querySelector("input[name='positionZ']").value = xData
                break;
              case "y":
                fieldset.querySelector("input[name='positionX']").value = yData
                fieldset.querySelector("input[name='positionZ']").value = xData
                break;
              case "z":
                fieldset.querySelector("input[name='positionX']").value = yData
                fieldset.querySelector("input[name='positionY']").value = xData
                break;
            }
          }
        }

        const canvas = plotToCanvas({
          xlim: data.xlim,
          ylim: data.ylim,
          xlabel: data.xlabel,
          ylabel: data.ylabel,
          xticks: data.xticks,
          yticks: data.yticks,
          image: data.image,
          clickCallback,
          drawLine: false
        })
        document.getElementById('plotArea').appendChild(canvas);
      })
  }
</script>
<div class="row">
    <div class="col">
        <button type="button" onclick="clickToPositionTransducerHandler(this)" class="btn btn-link">Click to position</button>
    </div>
</div>